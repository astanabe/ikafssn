Installation instructions for ikafssn
=======================================

A. Installing pre-built packages
==================================

A1. Ubuntu (.deb package)
---------------------------

Pre-built .deb packages are available for Ubuntu 22.04 and 24.04 (amd64/arm64).
Download the appropriate .deb file from the GitHub Releases page:

  https://github.com/astanabe/ikafssn/releases

Package naming convention:

  ikafssn_<version>_ubuntu-<ubuntu_ver>_<arch>.deb

Examples:
  ikafssn_0.1.2026.02.28_ubuntu-24.04_amd64.deb
  ikafssn_0.1.2026.02.28_ubuntu-22.04_arm64.deb

Install the package:

  sudo apt install ./ikafssn_<version>_ubuntu-<ubuntu_ver>_<arch>.deb

Note: Ubuntu 22.04 packages do not include ikafssnhttpd (Drogon is not
available on 22.04). Ubuntu 24.04 packages include all commands including
ikafssnhttpd.

Verify:

  ikafssnindex --version


A2. macOS 26 Tahoe (Homebrew)
-------------------------------

On macOS 26 (Tahoe) with Apple Silicon (aarch64), install via the
Homebrew Tap:

  brew tap astanabe/ikafssn
  brew install ikafssn

This installs pre-built bottles when available, or builds from source
as a fallback.

Verify:

  ikafssnindex --version


A3. Pre-built tarball (manual installation)
---------------------------------------------

1. Install runtime dependencies

Ubuntu 24.04 (x86_64 / aarch64):

  sudo apt-get install -y \
    libtbb12 liblmdb0 libsqlite3-0 \
    libcurl4 libjsoncpp25 \
    zlib1g libbz2-1.0 liblzma5 libdeflate0

  For ikafssnhttpd (Linux only):

    sudo apt-get install -y libdrogon-dev

Ubuntu 22.04 (x86_64 / aarch64):

  sudo apt-get install -y \
    libtbb12 liblmdb0 libsqlite3-0 \
    libcurl4 libjsoncpp24 \
    zlib1g libbz2-1.0 liblzma5 libdeflate0

  Note: ikafssnhttpd is not available on Ubuntu 22.04.

macOS 26 (aarch64):

  brew install tbb lmdb sqlite3 curl jsoncpp xz libdeflate openssl@3

2. Extract and install binaries

  tar xf ikafssn-<version>-<platform>.tar.xz
  cp ikafssn-<version>-<platform>/ikafssn* /usr/local/bin/

3. Verify installation

  ikafssnindex --version


B. Building from source
========================

1. Install build dependencies
-------------------------------

Ubuntu 24.04 (x86_64 / aarch64):

  sudo apt-get install -y \
    build-essential cmake \
    libtbb-dev liblmdb-dev libsqlite3-dev \
    libcurl4-openssl-dev libjsoncpp-dev \
    zlib1g-dev libbz2-dev liblzma-dev libdeflate-dev autoconf

  For ikafssnhttpd (optional):

    sudo apt-get install -y \
      libdrogon-dev uuid-dev libmariadb-dev libyaml-cpp-dev \
      libbrotli-dev libhiredis-dev libpq-dev

Ubuntu 22.04 (x86_64 / aarch64):

  sudo apt-get install -y \
    build-essential cmake \
    libtbb-dev liblmdb-dev libsqlite3-dev \
    libcurl4-openssl-dev libjsoncpp-dev \
    zlib1g-dev libbz2-dev liblzma-dev libdeflate-dev autoconf \
    libssl-dev uuid-dev

  Note: ikafssnhttpd cannot be built on Ubuntu 22.04 (Drogon is not
  packaged for this release). Build with -DBUILD_HTTPD=OFF.

macOS (Homebrew):

  brew install cmake tbb lmdb sqlite3 curl jsoncpp \
    xz libdeflate autoconf automake libtool openssl@3

  For ikafssnhttpd (optional):

    brew install drogon

2. Build source-built libraries
---------------------------------

Run the following commands from the ikafssn source root.

Parasail:

  curl -L -o parasail-2.6.2.tar.gz \
    https://github.com/jeffdaily/parasail/archive/refs/tags/v2.6.2.tar.gz
  tar xf parasail-2.6.2.tar.gz
  cd parasail-2.6.2
  mkdir build && cd build
  cmake .. -DCMAKE_BUILD_TYPE=Release \
    -DCMAKE_INSTALL_PREFIX="$(realpath ../..)/parasail" \
    -DBUILD_SHARED_LIBS=OFF
  make -j$(nproc)
  make install
  cd ../..

  On macOS with CMake >= 4.0, add -DCMAKE_POLICY_VERSION_MINIMUM=3.5
  On macOS, use make -j$(sysctl -n hw.ncpu) instead of make -j$(nproc)

htslib:

  curl -L -o htslib-1.23.tar.bz2 \
    https://github.com/samtools/htslib/releases/download/1.23/htslib-1.23.tar.bz2
  tar xf htslib-1.23.tar.bz2
  cd htslib-1.23
  autoreconf -i
  ./configure --prefix="$(realpath ..)/htslib" \
    --disable-libcurl --disable-gcs --disable-s3
  make -j$(nproc)
  make install
  cd ..

  On macOS, add Homebrew paths to configure:
    ./configure --prefix="$(realpath ..)/htslib" \
      --disable-libcurl --disable-gcs --disable-s3 \
      CPPFLAGS="-I$(brew --prefix)/include" LDFLAGS="-L$(brew --prefix)/lib"

NCBI C++ Toolkit:

  curl -L -o ncbi-cxx-toolkit-public-release-30.0.0.tar.gz \
    https://github.com/ncbi/ncbi-cxx-toolkit-public/archive/refs/tags/release/30.0.0.tar.gz
  tar xf ncbi-cxx-toolkit-public-release-30.0.0.tar.gz
  cd ncbi-cxx-toolkit-public-release-30.0.0
  ./cmake-configure \
    --without-debug \
    --with-projects="objtools/blast/seqdb_reader;objtools/blast/blastdb_format" \
    --with-install="$(realpath ..)/ncbi-cxx-toolkit"
  cd CMake-GCC*/build
  make -j$(nproc)
  make install
  cd ../../..

  On macOS:
    export CFLAGS="-I$(brew --prefix)/include"
    export CXXFLAGS="-I$(brew --prefix)/include"
    (run cmake-configure as above, then:)
    cd CMake-Clang*/build
    make -j$(sysctl -n hw.ncpu)
    make install
    cd ../../..

3. Build ikafssn
------------------

  mkdir build && cd build
  cmake .. -DCMAKE_BUILD_TYPE=Release
  make -j$(nproc)
  make test

  On macOS (Homebrew), add the Homebrew prefix so CMake can find libdeflate:
    cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_PREFIX_PATH=$(brew --prefix)
    make -j$(sysctl -n hw.ncpu)

  To skip ikafssnhttpd:  cmake .. -DCMAKE_BUILD_TYPE=Release -DBUILD_HTTPD=OFF
  To skip ikafssnclient:  cmake .. -DCMAKE_BUILD_TYPE=Release -DBUILD_CLIENT=OFF

4. Install
-----------

  sudo make install

  Executables are installed to /usr/local/bin by default.
  To change the prefix:
    cmake .. -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/opt/ikafssn
